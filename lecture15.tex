%Template
%Copyright (C) 2019  Patrick Diehl
%
%This program is free software: you can redistribute it and/or modify
%it under the terms of the GNU General Public License as published by
%the Free Software Foundation, either version 3 of the License, or
%(at your option) any later version.

%This program is distributed in the hope that it will be useful,
%but WITHOUT ANY WARRANTY; without even the implied warranty of
%MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%GNU General Public License for more details.

%You should have received a copy of the GNU General Public License
%along with this program.  If not, see <http://www.gnu.org/licenses/>.
\documentclass[12pt,t]{beamer}

\beamertemplatenavigationsymbolsempty

% usepackage
%\usepackage{template/dbt}
\usepackage{listings}

\definecolor{comments}{RGB}{81,81,81}
\definecolor{keywords}{RGB}{255,0,90}

% lstlisting
\lstset{
    language=C,
    basicstyle=\footnotesize\ttfamily,
    keywordstyle=\color{keywords},
    showspaces=false,
    showstringspaces=false,
    commentstyle=\color{blue}\emph
    %frame=single,
    %rulecolor=\color{comments},
    %rulesepcolor=\color{comments},
    %backgroundcolor = \color{lightgray}
}

\usetheme{default}

\usepackage[
    type={CC},
    modifier={by-nc-nd},
    version={4.0},
]{doclicense} 

\input{template/variables.tex}

% frame slide
\title{\coursename}
\subtitle{Lecture 15: Parallel partition-based 1D heat equation }

%\author{\href{}{}}
%\institute {
%    \href{}{\tt \scriptsize \today}
%}
\date {
 \tiny \url{\courseurl}
\vspace{2cm}
\doclicenseThis  
  
}



\usepackage{ifxetex}

\ifxetex
\usepackage{fontspec}
\setmainfont{Raleway}
\fi

\ifluatex
\usepackage{fontspec}
\setmainfont{Raleway}
\fi


\begin{document} {
    \setbeamertemplate{footline}{}
    \frame {
        \titlepage
    }
}

\frame{

\tableofcontents

}

\AtBeginSection[]{
  \begin{frame}
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
    \usebeamerfont{title}\insertsectionhead\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Reminder}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Lecture 14}
\begin{block}{What you should know from last lecture}
\begin{itemize}
\item Using partitions to control the grain size
\item Moving objects with \lstinline|std::move|
\item Semaphores and \lstinline|hpx::lcos::local::sliding_semaphore|
\end{itemize}
\end{block}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Datastructure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[fragile]{Class for holding the data for each partition I\footnote{\tiny\url{https://en.cppreference.com/w/cpp/memory/unique_ptr}}}

\begin{lstlisting}
class partition_data
{
private:
    // Since we use a array of doubles, 
    // we need to store the size 
    std::size_t size_;
    // Instead of a std::vector, 
    // we use a array of doubles 
    std::unique_ptr<double[]> data_;
};
\end{lstlisting}

Note that \lstinline|std::unique_ptr| is a smart pointer containing another object as a pointer and destroy this object when the \lstinline|std::unique_ptr| goes of of scope.

\end{frame}

\begin{frame}[fragile]{Class for holding the data for each partition II}

\begin{lstlisting}
class partition_data
{
public:
    partition_data(std::size_t size)
      : data_(new double[size]), size_(size)
    {}

    partition_data(std::size_t size, double init_value)
      : data_(new double[size]),
        size_(size)
    {
        double base_value = double(init_value * size);
        for (std::size_t i = 0; i != size; ++i)
            data_[i] = base_value + double(i);
    }
};
\end{lstlisting}

\end{frame}

\begin{frame}[fragile]{The new expression\footnote{\tiny\url{https://en.cppreference.com/w/cpp/language/new}}}

\begin{lstlisting}
// Allocation of a single double value 
double* p = new double(42);

// Deallocate memory
delete p;

// Allocation of 5 double values
double* p = new double[5];

// Deallocate memory
delete[] p;

\end{lstlisting}

The \lstinline|new| expression initializes objects with dynamic storage duration, which means that the liftime of the object is not limited by the scope of creation.
\end{frame}


\begin{frame}[fragile]{Update the types}

\begin{lstlisting}
// As in the previous example, we use a shared future
// but instead of the double value for the heat, we
// store the partition data there
typedef hpx::shared_future<partition_data> partition;

// The standard vector holds the futures of partitions
// instead of the futures of doubles to control the
// grain size
typedef std::vector<partition> space;
\end{lstlisting}


\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Simulation control}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Scaling results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Summary}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Summary}
\begin{block}{After this lecture, you should know}
\begin{itemize}
\item 
\end{itemize}
\end{block}
\end{frame}


\end{document}